<img align="right" src="https://github.com/n00b69/woa-op7/blob/main/op7.png" width="350" alt="Windows 11 running on hotdog/guacamole">

# Запуск Windows на OnePlus 7 Pro / 7T Pro

## Разбиение устройства на разделы

### Что нужно
- ```Работающий мозг (серьёзно, вам нужно будет думать!)```

- `Разблокированный загрузчик`

- [`Android platform tools`](https://developer.android.com/studio/releases/platform-tools)
  
- [`Модифицированный TWRP`](https://github.com/n00b69/woa-op7/releases/tag/Recovery)


### Примечания
> [!WARNING]  
> **Все данные на устройстве будут удалены!** Сделайте резервную копию заранее, если это необходимо.  
>  
> **НЕ ПЕРЕЗАГРУЖАЙТЕ ТЕЛЕФОН!** Если вы считаете, что допустили ошибку — обратитесь за помощью в [чат Telegram](https://t.me/oneplus7woa).  
>  
> Вы можете окирпичить устройство, если выполните команды ниже неправильно. Пожалуйста, следуйте инструкции внимательно.

> [!Important]  
> Прошивка **OOS12** и кастомные прошивки на её основе, имеют **крайне экспериментальную** поддержку Windows и могут вообще не работать.  
>  
> При переключении между Android и Windows вам придётся каждый раз выполнять дополнительные шаги (описано в разделе **dualboot** этого руководства).  
>  
> **Рекомендуется перейти на OOS11** (или прошивку на основе OOS11), если вы планируете использовать Windows.

### Открытие CMD от имени администратора
> Скачайте **platform-tools** и извлеките папку куда-нибудь, затем откройте CMD от имени **администратора**.


>
> Рекомендуется держать это окно открытым и использовать его на протяжении всего руководства.
> 
> Замените `путь\к\platform-tools` фактическим путем к папке platform-tools, например **C:\platform-tools**.
```cmd
cd путь\к\platform-tools
```

> [!Note]
> Если ваше устройство не определяется в режиме fastboot или recovery, вам нужно установить USB-драйверы, [следуя этому руководству](troubleshooting-ru.md#???)

#### Загрузитесь в модифицированный recovery TWRP
> Пока ваш телефон находится в режиме fastboot, замените `путь\к\moddedtwrp.img` на фактический путь к образу

```cmd
fastboot boot путь\к\moddedtwrp.img
```

### Резервное копирование важных файлов
> Это создаст резервные копии **fsc** , **fsg** , **modemst1** и **modemst2** в текущем каталоге, где открыта ваша командная строка (например, C:\platform-tools ). Прежде чем продолжить, убедитесь, что эти файлы действительно там.
> 
> Сохраняйте эти резервные копии в надёжном месте. Если программное обеспечение вашего устройства будет повреждено, эти резервные копии могут вам понадобиться, иначе ваш телефон может потерять возможность использовать сотовую сеть.
>
> Если у вас есть ещё какие-то данные, которые вы хотите сохранить, сделайте это сейчас. Ваши данные на Android будут удалены на следующих этапах.
```cmd
cmd /c "for %i in (fsg,fsc,modemst1,modemst2) do (adb shell dd if=/dev/block/by-name/%i of=/tmp/%i.bin & adb pull /tmp/%i.bin)"
```

#### Резервное копирование загрузочного образа
> Это создаст резервную копию вашего загрузочного образа в текущем каталоге (это должна быть папка **platform-tools** ).
>
> Переподключите кабель, если появится сообщение "no devices/emulators found".
```cmd
adb pull /dev/block/by-name/boot_a boot.img
```

### Исправление GPT
> Если вы этого не сделаете, Windows может окирпичить ваше устройство.
```cmd
adb shell fixgpt
```

#### Открытие оболочки
```cmd
adb shell
```

### Подготовка к разметке
> [!Note]
> Если в какой-либо момент в parted вы увидите ошибку, предлагающую вам нажать "Yes/No" или "Ignore/Cancel", введите `Yes` или `Ignore` в зависимости от ситуации, чтобы игнорировать ошибки и продолжить.
>
> Если вы видите какие-либо ошибки **udevadm** , вы также можете их игнорировать.
```cmd
parted /dev/block/sda
```

#### Вывод текущей таблицы разделов
> Parted выведет список разделов, раздел **userdata** должен быть последним в списке.
```cmd
print
```

#### Удаление userdata
> Замените **$** на номер раздела **userdata** , который должен быть **19** или **22**
```cmd
rm $
```

#### Восстановление userdata
> Замените **7971MB** на прежнее начальное значение **userdata** которую мы только что удалили.
>
> Замените **64GB** на желаемое конечное значение для **userdata** . В этом примере доступное для использования пространство на Android составит 64 ГБ – 7971 МБ = **56GB**
```cmd
mkpart userdata ext4 7971MB 64GB
```

#### Создание раздела ESP
> Замените **64GB** на конечное значение **userdata**
>
> Замените **64.3GB** на значение, которое вы использовали ранее, добавив к нему **0.3GB** 
```cmd
mkpart esp fat32 64GB 64.3GB
```

#### Создание раздела Windows
> Замените **64.3GB** на конечное значение **esp**
```cmd
mkpart win ntfs 64.3GB -0MB
```

#### Делаем ESP загрузочным 
> Используйте `print` для просмотра всех разделов. Замените «$» на номер вашего раздела ESP ( **20** или **23**).
```cmd
set $ esp on
```

#### Выход из parted
```cmd
quit
```

### Форматирование данных
- Отформатируйте все данные в TWRP, иначе Android не загрузится.
- ( Перейдите в `Wipe` > `Format data` > введите `yes` )

#### Проверьте, запускается ли Android
- Просто перезагрузите телефон и проверьте, работает ли Android
- Если он не загружается, загрузитесь в стоковое рекавери и выполните **сброс настроек до заводских**
- Выберите **`Wipe data and cache`** > **`Erase everything`** > **`yes`**

### Форматирование разделов Windows и ESP
> Загрузите модифицированный TWRP снова, затем выполните следующую команду
```cmd
adb shell format
```

## [Следующий шаг: получение root-прав на телефоне](2-root-ru.md)





















