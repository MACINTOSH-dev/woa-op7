<img align="right" src="https://github.com/n00b69/woa-op7/blob/main/op7.png" width="350" alt="Windows 11 running on hotdog/guacamole">

# Запуск Windows на OnePlus 7 Pro / 7T Pro

## Разбиение устройства на разделы

### Что нужно
- Разблокированный загрузчик

- [ADB & Fastboot](https://developer.android.com/studio/releases/platform-tools)
  
- [Модифицированный TWRP](https://github.com/n00b69/woa-op7/releases/download/Files/moddedtwrp.img)

### Примечание
> [⚠️ВНИМАНИЕ]  
> 
> НЕ ПЕРЕЗАГРУЖАЙТЕ ТЕЛЕФОН! Если вы считаете, что совершили ошибку, обратитесь за помощью в [чат Telegram](https://t.me/oneplus7woa).
> 
> Не запускайте все команды сразу, выполняйте их по порядку!
>
> ВЫ МОЖЕТЕ СЛОМАТЬ ВАШЕ УСТРОЙСТВО С ПОМОЩЬЮ КОМАНД НИЖЕ, ЕСЛИ ВЫ СДЕЛАЕТЕ ИХ НЕПРАВИЛЬНО!!!

> [☝️Важно]
> OOS12 и ROM, использующие прошивку OOS12, имеют крайне экспериментальную поддержку Windows и могут вообще не работать.
>
> Если вы хотите использовать Windows, настоятельно рекомендуется перейти на OOS11.

### Открытие CMD от имени администратора
> Скачайте **platform-tools** и извлеките папку куда-нибудь, затем откройте CMD от имени **администратора**.


>
> Рекомендуется держать это окно открытым и использовать его на протяжении всего руководства.
> 
> Замените `путь\к\platform-tools` фактическим путем к папке platform-tools, например **C:\platform-tools**.
```cmd
cd путь\к\platform-tools
```

> [⚠️Примечание]
> Если ваше устройство не определяется в режиме быстрой загрузки или восстановления, вам придется установить USB-драйверы, [следуя этому руководству](troubleshooting.md#device-is-not-recognized-in-fastboot-or-recovery)

#### Загрузитесь в модифицированный recovery TWRP
> Пока ваш телефон находится в режиме fastboot, замените `путь\к\moddedtwrp.img` на фактический путь к образу
>
> Если образ не загружается на OnePlus 7 Pro (guacamole), используйте вместо него [этот образ](https://github.com/n00b69/woa-op7/releases/download/Files/guacamolefunny.img) 
```cmd
fastboot boot путь\к\moddedtwrp.img
```

### Резервное копирование важных файлов
> Это создаст резервные копии файлов fsc , fsg , modemst1 и modemst2 в текущем каталоге, где открыта ваша командная строка (например, C:\platform-tools ). Прежде чем продолжить, убедитесь, что эти файлы действительно там.
> 
> Сохраняйте эти резервные копии в надёжном месте. Если программное обеспечение вашего устройства будет повреждено, эти резервные копии могут вам понадобиться, иначе ваш телефон может потерять связь с сотовой сетью.
>
> Если у вас есть ещё какие-то данные, которые вы хотите сохранить, сделайте это сейчас. Ваши данные на Android будут удалены на следующих этапах.
```cmd
cmd /c "for %i in (fsg,fsc,modemst1,modemst2) do (adb shell dd if=/dev/block/by-name/%i of=/tmp/%i.bin & adb pull /tmp/%i.bin)"
```

#### Резервное копирование загрузочного образа
> Это позволит создать резервную копию вашего загрузочного образа в текущем каталоге (это должна быть папка platform-tools ).
>
> Переподключите кабель, если появится сообщение «no devices/emulators found».
```cmd
adb pull /dev/block/by-name/boot_a boot.img
```

### Исправление GPT
> Если вы этого не сделаете, Windows может сломать ваше устройство.
```cmd
adb shell fixgpt
```

#### Открытие оболочки
```cmd
adb shell
```

### Подготовка к разбиению на разделы
> [⚠️Примечание]
> Если в какой-либо момент в parted вы увидите ошибку, предлагающую вам нажать "Yes/No" или "Ignore/Cancel", введите `Yes` или `Ignore` в зависимости от ситуации, чтобы игнорировать ошибки и продолжить.
>
> Если вы видите какие-либо ошибки **udevadm** , вы также можете их игнорировать.
```cmd
parted /dev/block/sda
```

#### Печать текущей таблицы разделов
> Parted выведет список разделов, раздел **userdata** должен быть последним в списке.
```cmd
print
```

#### Удаление userdata
> Замените **$** на номер раздела **userdata** , который должен быть **19** или **22**
```cmd
rm $
```

#### Восстановление userdata
> Замените **7971MB** на прежнее начальное значение **userdata** которое мы только что удалили.
>
> Замените **64GB** на желаемое конечное значение для **userdata** . В этом примере доступное для использования пространство на Android составит 64 ГБ – 7971 МБ = **56GB**
```cmd
mkpart userdata ext4 7971MB 64GB
```

#### Создание раздела ESP
> Замените **64GB** на конечное значение **userdata**
>
> Замените **64.3GB** на значение, которое вы использовали ранее, добавив к нему **0.3GB** 
```cmd
mkpart esp fat32 64GB 64.3GB
```

#### Создание раздела Windows
> Замените **64.3GB** на конечное значение **esp**
```cmd
mkpart win ntfs 64.3GB -0MB
```

#### Делаем ESP загрузочным 
> Используйте `print` для просмотра всех разделов. Замените «$» на номер вашего раздела ESP ( **20** или **23**).
```cmd
set $ esp on
```

#### Выход из parted
```cmd
quit
```

### Форматирование данных
- Отформатируйте все данные в TWRP, иначе Android не загрузится.
- ( Перейдите в Wipe > Format data > введите yes )

#### Проверьте, запускается ли Android
- Просто перезагрузите телефон и проверьте, работает ли Android
- Если этого не произошло, загрузитесь в стандартное рекавери и выполните сброс настроек до заводских
- В TWRP выберите **Wipe data and cache** > **Erase everything** > **yes**

### Форматирование дисков Windows и ESP
> Перезагрузитесь в модифицированный TWRP, затем выполните следующую команду
```cmd
adb shell format
```

## [Следующий шаг: получение root-прав на телефоне](2-root.md)





















